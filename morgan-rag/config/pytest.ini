# =============================================================================
# Pytest Configuration for Morgan v2-0.0.1
# =============================================================================
# Pytest is a mature full-featured Python testing framework
# Documentation: https://docs.pytest.org/
# =============================================================================

[pytest]

# =============================================================================
# Test Discovery
# =============================================================================

# Directories to search for tests
testpaths = tests

# File patterns for test discovery
python_files = test_*.py *_test.py

# Class patterns for test discovery
python_classes = Test* *Tests

# Function patterns for test discovery
python_functions = test_*

# =============================================================================
# Output and Reporting
# =============================================================================

# More verbose output
# -v: verbose
# -vv: more verbose
# --tb=short: shorter traceback format
addopts =
    --verbose
    --strict-markers
    --strict-config
    --tb=short
    --color=yes
    --code-highlight=yes
    --showlocals
    --disable-warnings
    --maxfail=5
    --ff

# Show local variables in tracebacks
showlocals = true

# =============================================================================
# Coverage Settings
# =============================================================================

# Enable coverage reporting (requires pytest-cov)
# Uncomment to enable coverage by default
# addopts =
#     --cov=morgan
#     --cov-report=html
#     --cov-report=term-missing
#     --cov-report=xml
#     --cov-branch
#     --no-cov-on-fail

# Coverage minimum threshold (uncomment to enforce)
# [coverage:report]
# fail_under = 80

# =============================================================================
# Async Testing
# =============================================================================

# Asyncio mode for async tests (requires pytest-asyncio)
asyncio_mode = auto

# =============================================================================
# Markers
# =============================================================================

# Define custom markers to categorize tests
markers =
    unit: Unit tests (fast, isolated)
    integration: Integration tests (slower, require services)
    e2e: End-to-end tests (slowest, full system)
    slow: Tests that take a long time to run
    fast: Tests that run quickly
    smoke: Smoke tests for basic functionality
    regression: Regression tests for bug fixes
    security: Security-related tests
    performance: Performance and load tests
    llm: Tests requiring LLM service
    tts: Tests requiring TTS service
    stt: Tests requiring STT service
    qdrant: Tests requiring Qdrant vector database
    redis: Tests requiring Redis
    postgres: Tests requiring PostgreSQL
    cuda: Tests requiring CUDA/GPU
    skip_ci: Skip in CI environment
    wip: Work in progress tests

# =============================================================================
# Test Execution Options
# =============================================================================

# Minimum Python version required
minversion = 7.0

# Patterns for files/directories to ignore
norecursedirs =
    .git
    .tox
    .env
    .venv
    venv
    dist
    build
    *.egg
    __pycache__
    .cache
    .pytest_cache
    .mypy_cache
    .ruff_cache
    node_modules

# =============================================================================
# Logging
# =============================================================================

# Log level for test output
log_cli = false
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(name)s - %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

# Capture log messages in test reports
log_file = tests/logs/pytest.log
log_file_level = DEBUG
log_file_format = %(asctime)s [%(levelname)8s] %(name)s - %(message)s
log_file_date_format = %Y-%m-%d %H:%M:%S

# =============================================================================
# Warnings
# =============================================================================

# Filter warnings
filterwarnings =
    error
    ignore::UserWarning
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::FutureWarning

# =============================================================================
# Timeout Settings
# =============================================================================

# Timeout for tests (requires pytest-timeout)
# timeout = 300
# timeout_method = thread

# =============================================================================
# Fixtures
# =============================================================================

# Use fixtures from conftest.py
# usefixtures =

# =============================================================================
# Test Collection
# =============================================================================

# Consider classes as test classes even without Test prefix
# (if they have test methods)
collect_ignore = []

# =============================================================================
# Console Output
# =============================================================================

# Console output mode
console_output_style = progress

# =============================================================================
# Xdist Settings (Parallel Testing)
# =============================================================================

# Number of CPUs to use for parallel testing (requires pytest-xdist)
# Uncomment to enable parallel testing
# addopts = -n auto

# =============================================================================
# Environment Variables
# =============================================================================

# Set environment variables for tests
env =
    MORGAN_ENVIRONMENT=test
    MORGAN_LOG_LEVEL=DEBUG
    MORGAN_DEBUG=true

# =============================================================================
# Test Data
# =============================================================================

# Directory for test data files
# test_data_dir = tests/data

# =============================================================================
# Test Order
# =============================================================================

# Randomize test order (requires pytest-randomly)
# Uncomment to randomize
# addopts = --randomly-seed=1234
